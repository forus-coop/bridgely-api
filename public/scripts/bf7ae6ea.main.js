window.bridgelyApp={Models:{},Collections:{},Views:{},Routers:{},init:function(){"use strict";bridgelyApp.apiUrl="http://bridgely-api.herokuapp.com/v1",bridgelyApp.session=new bridgelyApp.Models.SessionModel,bridgelyApp.appView=new bridgelyApp.Views.AppView({model:bridgelyApp.session}),_(bridgelyApp.Routers).each(function(a,b){bridgelyApp[b]=new a}),Backbone.history.fragment&&Backbone.history.loadUrl(Backbone.history.fragment),Backbone.history.start(),console.log("Hello from Bridgely!")}},$(document).ready(function(){"use strict";$.fn.extend({limiter:function(a,b){function c(b,c){var d=b.value.length;d>a&&(b.value=b.value.substr(0,a),d=a),c.html(a-d)}$(this).on("keyup focus",function(){c(this,b)}),c($(this)[0],b)}}),bridgelyApp.init()}),$(document).ajaxError(function(a,b,c,d){console.log("error",a,b,c,d),401===b.status?(bridgelyApp.session.destroy(),bridgelyApp.LoginRouter.navigate("login",{trigger:!0})):403===b.status&&bridgelyApp.IndexRouter.navigate("",{trigger:!0})}),this.JST=this.JST||{},this.JST["app/scripts/templates/adminCompanies.ejs"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj)__p+='<div class="admin-companies">\n    <h2>Companies Directory</h2>\n    <div class="well companies list-group">\n\n    ',this.collection.each(function(a){__p+='\n      <a class="company list-group-item" id=\'companies-'+(null==(__t=a.id)?"":__t)+'\' href="#">\n        <p class="list-group-item-text pull-right">'+(null==(__t=a.get("settings").account_phone_number)?"":__t)+'</p>\n        <h4 class="list-group-item-heading">'+(null==(__t=a.get("name"))?"":__t)+"</h4>\n      </a>\n    "}),__p+='\n\n  </div>\n  <div><p></p></div>\n  <div>\n    <button type="button" class="btn btn-company btn-lg btn-block btn-danger"><span class="glyphicon glyphicon-flash"></span> Add a New Company</button>\n  </div>\n</div>\n';return __p},this.JST["app/scripts/templates/adminCompanyTopbar.ejs"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+='<div class="panel-body">\n<h4>\n<a href=\'#\' class="admin-return pull-right"> Back to Companies &rarr; </a>\n  You are acting on behalf of <u>'+(null==(__t=bridgelyApp.session.get("company").name)?"":__t)+"</u>\n</h4>\n</div>";return __p},this.JST["app/scripts/templates/adminNewCompany.ejs"]=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<div class=\'col-md-2\'></div>\n\n<div class=\'col-md-8\'>\n  <div class="panel panel-info">\n    <div class="panel-heading">\n      <h3 class="panel-title">Important</h3>\n    </div>\n    <div class="panel-body">\n      <ul>\n        <li>All fields are required!</li>\n        <li>The company name & email address must be <strong>unique</strong>.</li>\n        <li><u>Password must be a minimum of 8 characters</u>.</li>\n        <li>Welcome Message can be updated in company settings.</li>\n      </ul>\n    </div>\n  </div>\n\n  <div class="well">\n    <legend>Add a New Company</legend>\n\n    <div class="form-group">\n      <label class="col-md-2 control-label">Name</label>\n      <div class="col-md-8">\n        <input class="form-control" type="text" name="company-name"></input>\n        <p><em>Enter the company\'s name</em>.\n        <br />A SMS Number will be provisioned on submission</p>\n      </div>\n      <div class="col-md-2"></div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-md-2 control-label">Identifier</label>\n      <div class="col-md-8">\n        <input class="form-control" type="text" name="company-short-name"></input>\n        <p><em>Enter the company\'s short name or identifier</em>.\n        <br />This value is used in the link hash as the company identifier</p>\n      </div>\n      <div class="col-md-2"></div>\n    </div>\n\n    <legend>Company Settings</legend>\n\n    <div class="form-group">\n      <label class="col-md-2 control-label">Welcome Message</label>\n      <div class="col-md-8">\n        <textarea class="form-control" rows="4" name="autoresponder" placeholder="Enter the message employees will receive when they register in the mobile directory. Variables are available to insert dynamic values. Please be mindful of the 160 character message limit."></textarea>\n        <small><em>160 / 160 Characters Left</em></small>\n        <p>\n          <code>\n            <br />Insert the welcome link with: [link]\n            <br />Insert the company name with: [company]\n            <br />Insert the employee\'s first name with: [name]\n          </code>\n        </p>\n      </div>\n      <div class="col-md-2"></div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-md-2 control-label">Welcome Link</label>\n      <div class="col-md-8">\n        <div class="input-group">\n          <input type="text" class="form-control" name="autoresponder-link" placeholder="www.example.com">\n          <span class="input-group-addon">/hash</span>\n        </div>\n        <small>Enter the root of the welcome link URL, a unique hash will be appended automatically for each employee</small>\n      </div>\n      <div class="col-md-2"></div>\n    </div>\n\n    <legend>Add a Company User</legend>\n\n    <div class="form-group">\n      <label class="col-md-2 control-label">Name</label>\n      <div class="col-md-8">\n        <input class="form-control" type="text" name="users-name" placeholder="The person\'s name"></input>\n      </div>\n      <div class="col-md-2"></div>\n    </div>\n\n    <div class="form-group">\n      <label class="col-md-2 control-label">Email</label>\n      <div class="col-md-8">\n        <input class="form-control" type="email" name="email"></input>\n      </div>\n      <div class="col-md-2"></div>\n    </div>\n\n    <div class="form-group">\n      <label for"password" class="col-md-2 control-label">Password</label>\n      <div class="col-md-8">\n        <input class="form-control" type="password" name="password" placeholder="At least 8 characters"></input>\n      </div>\n      <div class="col-md-2"></div>\n    </div>\n\n    <div class="form-group">\n      <div class="col-md-2"></div>\n      <div class="col-md-8">\n        <button type="submit" class="btn btn-lg btn-danger btn-block"><span class="glyphicon glyphicon-flash"></span> Create Company</button>\n      </div>\n      <div class="col-md-2"><span class="help-block"><br />or, <a class="cancel" href="#">cancel</a></span></div>\n    </div>\n  </div>\n</div>\n\n<div class=\'col-md-2\'></div>\n';return __p},this.JST["app/scripts/templates/app.ejs"]=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<section id="bridgely-app" class="container">\n  <div id="topbar"></div>\n\n  <div id="content"> <!-- Bridgely loads views here -->\n\n    <div class="lead">\n      <div class="hero-unit">\n          <h1>Welcome to <strong>Bridgely</strong></h1>\n          Please login to proceed.\n      </div>\n    </div>\n\n  </div>\n\n</section>\n';return __p},this.JST["app/scripts/templates/employee.ejs"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,obj)__p+='<h4 class="pull-right">'+(null==(__t=this.model.get("phone"))?"":__t)+'</h4>\n<h2><span class="label label-default">'+(null==(__t=this.model.get("name"))?"":__t)+'</span></h2>\n<span class="tags"></span>\n<p></p>\n<div class="messages">\n  <div class="preloader">\n    <img src="http://corp.forusall.com/images/preloader52.gif" />\n  </div>\n</div>\n<h5><a href=# class=back>&larr; Back to directory</a></h5>';return __p},this.JST["app/scripts/templates/employees.ejs"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj)__p+='<div>\n\n  <div class="btn-group pull-right">\n    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">\n      <span class="glyphicon glyphicon-star"></span> Send to All\n      <span class="caret"></span>\n    </button>\n    <ul class="dropdown-menu">\n       <li><a id="sms-all" href="#"><span class="glyphicon glyphicon-send"></span> Send a Message</a></li>\n       <li><a id="question-all" href="#"><span class="glyphicon glyphicon-question-sign"></span> Ask a Question</a></li>\n    </ul>\n  </div>\n\n  <div class="btn-group pull-right">\n    <button type="button" class="btn btn-success dropdown-toggle btn-questions" data-toggle="dropdown">\n      <span class="glyphicon glyphicon-retweet"></span>  Show Columns\n      <span class="caret"></span>\n    </button>\n    <div class="dropdown-menu tag-list list-group">\n\n      ',this.tags().length?(__p+="\n\n        ",_.each(this.tags(),function(a){__p+='\n          <div class="tag-list-item list-group-item">\n            <label>\n              <input type="checkbox" name="'+(null==(__t=a)?"":__t)+'"> '+(null==(__t=a.replace(/"/g,""))?"":__t)+"</input>\n            </label>\n          </div>\n        "}),__p+="\n\n      "):__p+='\n\n        <div class="tag-list-item list-group-item">\n          <label>\n            <span class="glyphicon glyphicon-ban-circle"></span> No columns, yet\n          </label>\n        </div>\n\n      ',__p+="\n\n    </div>\n  </div>\n\n  <h2>\n    ",bridgelyApp.session.get("company")&&(__p+="\n    "+(null==(__t=bridgelyApp.session.get("company").name+"")?"":__t)+"\n    "),__p+='\n    Mobile Directory\n  </h2>\n\n<div class="grid-filter pull-right"></div>\n\n  <h4>\n    ',__p+=bridgelyApp.session.get("company")?"\n    "+(null==(__t=bridgelyApp.session.get("company").settings.account_phone_number)?"":__t)+"\n    ":"\n      Admin View\n    ",__p+='\n  </h4>\n\n</div>\n\n<div class=backgrid-container>\n   <div class="btn-group pull-left">\n    <button type="button" class="btn btn-primary dropdown-toggle send-selected" data-toggle="dropdown" disabled>\n      <span class="glyphicon glyphicon-check"></span> Send to Selected\n      <span class="caret"></span>\n    </button>\n    <ul class="dropdown-menu">\n      <li><a id="sms-selected" href="#"><span class="glyphicon glyphicon-send"></span> Send a Message</a></li>\n      <li><a id="question-selected" href="#"><span class="glyphicon glyphicon-question-sign"></span> Ask a Question</a></li>\n    </ul>\n  </div>\n  <div class="backgrid-footer">\n  </div>\n</div>';return __p},this.JST["app/scripts/templates/footer.ejs"]=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<p>Honest. Simple. Together.</p>\n<img src="http://corp.forusall.com/images/ForUsLogo.png" />\n';return __p},this.JST["app/scripts/templates/login.ejs"]=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+='<div class="col-md-3"></div>\n<div class="well col-md-6">\n  <form role="form" class="form-horizontal">\n    <legend>Please Login to Proceed</legend>\n    <div class="alert alert-danger alert-dismissable">\n      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\n      Invalid Email or password. Please try again.\n    </div>\n    <div class="form-group">\n      <label for="email" class="col-lg-3 control-label">Email Address</label>\n      <div class="col-lg-9">\n        <input type="email" class="form-control input-lg" id="email" placeholder="Enter email">\n      </div>\n    </div>\n    <div class="form-group">\n      <label for="password" class="col-lg-3 control-label">Password</label>\n      <div class="col-lg-9">\n        <input type="password" class="form-control input-lg" id="password" placeholder="Password">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <div class="col-lg-12">\n        <button type="submit" class="btn btn-block btn-lg btn-info">Login <span class="glyphicon glyphicon-log-out"></span></button>\n      </div>\n<!--       <div class="col-lg-8"><button type="submit" class="btn btn-block btn-info">Login <span class="glyphicon glyphicon-log-out"></span></button></div>\n      <div class="col-lg-4"><small><a href="#">Forgot your password?</a></small></div> -->\n    </div>\n  </form>\n</div>\n<div class="col-md-3"></div>';return __p},this.JST["app/scripts/templates/message.ejs"]=function(obj){obj||(obj={});var __p="";with(_.escape,obj)__p+="<p>Your content here.</p>\n\n";return __p},this.JST["app/scripts/templates/messages.ejs"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj)__p+="<div>\n  <h2>Message History ",bridgelyApp.session.get("company")&&(__p+="\n  "+(null==(__t=" for "+bridgelyApp.session.get("company").name)?"":__t)+"\n  "),__p+='\n  </h2>\n<!--   <ul id="history-pills" class="nav nav-pills">\n    <li class="active"><a href="#">All</a></li>\n    <li><a href="#">Outbound</a></li>\n    <li><a href="#">Inbound</a></li>\n  </ul> -->\n</div>\n\n<div class=backgrid-container>\n\n  <div class="backgrid-footer"></div>\n\n</div>';return __p},this.JST["app/scripts/templates/navbar.ejs"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj)__p+='<!-- Brand and toggle get grouped for better mobile display -->\n<div class="navbar-header">\n  <a class="navbar-brand" href="#">Bridgely</a>\n</div>\n\n<!-- Collect the nav links, forms, and other content for toggling -->\n<div>\n  <ul class="nav navbar-nav">\n\n',bridgelyApp.session.authenticated()?(__p+='\n    <li><a href="#" class="directory"><span class="glyphicon glyphicon-user"></span> Directory</a></li>\n    <li class="dropdown">\n      <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-inbox"></span> Messages <b class="caret"></b></a>\n      <ul class="dropdown-menu">\n        <li><a href="#" class="new-message"><span class="glyphicon glyphicon-send"></span> Send a Message</a></li>\n        <li><a href="#" class="new-question"><span class="glyphicon glyphicon-question-sign"></span> Ask a Question</a></li>\n        <li class="divider"></li>\n        <li><a href="#" class="message-history"><span class="glyphicon glyphicon-transfer"></span> Message History</a></li>\n      </ul>\n    </li>\n  </ul>\n  <ul class="nav navbar-nav navbar-right">\n    <li class="dropdown">\n      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Welcome back, '+(null==(__t=bridgelyApp.session.get("name").split(" ")[0])?"":__t)+' <b class="caret"></b></a>\n      <ul class="dropdown-menu">\n        ',bridgelyApp.session.get("admin")!==!0||bridgelyApp.session.get("company")||(__p+='\n        <li class="dropdown-header">ADMIN PAGES</li>\n        <li><a class="admin-companies" href="#"><span class="glyphicon glyphicon-tower"></span> Companies</a></li>\n        <li class="disabled"><a class="admin-users" href="#"><span class="glyphicon glyphicon-user"></span> Users</a></li>\n        <li class="divider"></li>\n        '),__p+="\n\n        ",bridgelyApp.session.get("company")&&(__p+='\n        <li class="dropdown-header">\n          <h5><span class="label label-default">\n            '+(null==(__t=bridgelyApp.session.get("company").name)?"":__t)+'\n          </span></h5>\n        </li>\n        <li><a href="#" class="account"><span class="glyphicon glyphicon-cog"></span> Settings</a></li>\n        <li class="divider"></li>\n        '),__p+='\n\n        <li><a href="#" class="logout"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>\n      </ul>\n    </li>\n  </ul>\n'):__p+='\n  </ul>\n  <ul class="nav navbar-nav navbar-right">\n        <li><a href="#" class="login"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>\n  </ul>\n\n',__p+="\n</div><!-- /.navbar-collapse -->\n";return __p},this.JST["app/scripts/templates/newMessage.ejs"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj)__p+='<div class=\'col-md-2\'></div>\n\n<div class=\'well col-md-8\'>\n  <legend>Send a SMS Message</legend>\n\n  <div class="form-group clearfix">\n    <label class="col-md-2 control-label">From</label>\n    <div class="col-md-8">\n      <p class="form-control-static input-lg">\n\n        ',__p+=bridgelyApp.session.get("company")&&bridgelyApp.session.get("company").settings.account_phone_number?"\n            "+(null==(__t=bridgelyApp.session.get("company").settings.account_phone_number)?"":__t)+"\n        ":"\n            <strong>Not yet assigned</strong>\n        ",__p+='\n\n      </p>\n      <p><em>Your SMS Number</em></p>\n    </div>\n    <div class="col-md-2"></div>\n  </div>\n\n  <div class="form-group clearfix">\n    <label class="col-md-2 control-label">To</label>\n    <div class="col-md-8">\n      <p class="form-control-static input-lg">\n        ',__p+="all"!==bridgelyApp.session.get("new_message_employee_ids")?"\n          "+(null==(__t=bridgelyApp.session.get("new_message_employee_ids").length)?"":__t)+" Selected Employees\n        ":"\n          Whole Mobile Directory\n        ",__p+='\n      </p>\n    </div>\n    <div class="col-md-2"></div>\n  </div>\n\n  <div class="form-group clearfix">\n    <label class="col-md-2 control-label">Message</label>\n    <div class="col-md-8">\n      <textarea class="form-control input-lg" maxlength="160" rows="4"></textarea>\n      <span class="help-block"><span id="chars">160</span> / 160 characters remaining</span>\n      <code>\n        <br />Insert the welcome link with: [link]\n        <br />Insert the employee\'s first name with: [name]\n      </code>\n    </div>\n    <div class="col-md-2"></div>\n  </div>\n\n  <div class="form-group clearfix">\n    <div class="col-md-2"></div>\n    <div class="col-md-8">\n      <button type="submit" class="btn btn-lg btn-primary btn-block"><span class="glyphicon glyphicon-send"></span> Send SMS</button>\n    </div>\n    <div class="col-md-2"><span class="help-block"><br />or, <a class="cancel" href="#">cancel</a></span></div>\n  </div>\n\n</div>\n\n<div class=\'col-md-2\'></div>\n\n<!-- Modal -->\n<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="success" aria-hidden="true">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h2 class="modal-title" id="success">Success!</h2>\n      </div>\n      <div class="modal-body">\n        <h3>Your message has been queued up and will begin sending momentarily</h3>\n        <br />\n        <p>Please wait at least 6 hours before sending additional messages or questions so your queue can be processed.</p>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-lg btn-primary" id="success-button">Continue</button>\n        <p class="pull-left"><small><em>Allow up to 4 hours for all messages to be delivered.</em></small></p>\n      </div>\n    </div><!-- /.modal-content -->\n  </div><!-- /.modal-dialog -->\n</div><!-- /.modal -->\n\n';return __p},this.JST["app/scripts/templates/newQuestion.ejs"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj)__p+='<div class=\'col-md-2\'></div>\n\n<div class=\'well col-md-8\'>\n  <legend>Send a SMS Question</legend>\n\n  <div class="form-group clearfix">\n    <label class="col-md-2 control-label">From</label>\n    <div class="col-md-8">\n      <p class="form-control-static input-lg">\n\n      ',__p+=bridgelyApp.session.get("company")&&bridgelyApp.session.get("company").settings.account_phone_number?"\n            "+(null==(__t=bridgelyApp.session.get("company").settings.account_phone_number)?"":__t)+"\n       ":"\n            <strong>Not yet assigned</strong>\n       ",__p+='\n\n      </p>\n      <p><em>Your SMS Number</em></p>\n    </div>\n    <div class="col-md-2"></div>\n  </div>\n\n  <div class="form-group clearfix">\n    <label class="col-md-2 control-label">To</label>\n    <div class="col-md-8">\n      <p class="form-control-static input-lg">\n        ',__p+="all"!==bridgelyApp.session.get("new_message_employee_ids")?"\n          "+(null==(__t=bridgelyApp.session.get("new_message_employee_ids").length)?"":__t)+" Selected Employees\n        ":"\n          Whole Mobile Directory\n        ",__p+='\n      </p>\n    </div>\n    <div class="col-md-2"></div>\n  </div>\n\n\n  <div class="form-group clearfix">\n    <label class="col-md-2 control-label">Quesion Name</label>\n    <div class="col-md-8">\n        <input type="text" class="form-control input-lg" id="question-title" maxlength="15" placeholder="Enter a short name for your question, e.g. Age">\n    </div>\n    <div class="col-md-2"></div>\n  </div>\n\n  <div class="form-group clearfix">\n    <label class="col-md-2 control-label">Question</label>\n    <div class="col-md-8">\n      <textarea class="form-control input-lg" rows="4" maxlength="160" placeholder="Enter the question that you want to text to your employees, e.g. What is your age?"></textarea>\n      <span class="help-block"><span id="chars">160</span> / 160 characters remaining</span>\n      <code>\n        <br />Insert the welcome link with: [link]\n        <br />Insert the employee\'s first name with: [name]\n      </code>\n    </div>\n    <div class="col-md-2"></div>\n  </div>\n\n  <div class="form-group clearfix">\n    <div class="col-md-2"></div>\n    <div class="col-md-8">\n      <button type="submit" class="btn btn-lg btn-primary btn-block"><span class="glyphicon glyphicon-send"></span> Send SMS Question</button>\n    </div>\n    <div class="col-md-2"><span class="help-block"><br />or, <a class="cancel" href="#">cancel</a></span></div>\n  </div>\n\n</div>\n\n<div class=\'col-md-2\'></div>\n\n<!-- Modal -->\n<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="success" aria-hidden="true">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h2 class="modal-title" id="success">Success!</h2>\n      </div>\n      <div class="modal-body">\n        <h3>Your question has been queued and will begin sending momentarily</h3>\n        <br />\n        <p>Please wait before sending more messages or questions so incoming responses to this question can be processed.</p>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-lg btn-primary" id="success-button">Continue</button>\n        <p class="pull-left"><small><em>Allow up to 4 hours for all messages to be delivered.</em></small></p>\n      </div>\n    </div><!-- /.modal-content -->\n  </div><!-- /.modal-dialog -->\n</div><!-- /.modal -->\n\n';return __p},this.JST["app/scripts/templates/question.ejs"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj)__p+='<h2><span class="label label-default">'+(null==(__t=this.model.get("title"))?"":__t)+"</span></h2>\n<h3>"+(null==(__t=this.model.get("message").body)?"":__t)+'</h3>\n\n<div class="recipients">\n  ',_(this.model.get("employees")).each(function(a){__p+='\n    <div class="list-group-item">\n      <div class="list-group-item-text">\n      <a href=# class="employee employee-'+(null==(__t=a.id)?"":__t)+'"> '+(null==(__t=a.name)?"":__t)+" </a>\n      ",a.data&&a.data.tags&&a.data.tags[this.model.get("title")]&&(__p+='\n        <span class="label label-default">'+(null==(__t=a.data.tags[this.model.get("title")])?"":__t)+"</span>\n      "),__p+="\n      </div>\n    </div>\n  "},this),__p+="\n</div>\n<h5><a href=# class=back>&larr; Back to message history</a></h5>";return __p},this.JST["app/scripts/templates/settings.ejs"]=function(obj){obj||(obj={});var __t,__p="";with(_.escape,Array.prototype.join,obj)__p+="<div class='col-md-2'></div>\n\n<div class='well col-md-8'>\n  <legend>\n    "+(null==(__t=bridgelyApp.session.get("company").name||"N/A")?"":__t)+' Settings\n  </legend>\n\n  <div class="form-group clearfix">\n    <label class="col-md-2 control-label">Welcome Message</label>\n    <div class="col-md-8">\n      <textarea class="form-control" rows="4" name="autoresponder"></textarea>\n      <small><em><span id="chars">160</span> / 160 Characters Left</em></small>\n      <p>\n        <code>\n          <br />Insert the welcome link with: [link]\n          <br />Insert the company name with: [company]\n          <br />Insert the employee\'s first name with: [name]\n        </code>\n      </p>\n    </div>\n    <div class="col-md-2"></div>\n  </div>\n\n  <div class="form-group clearfix">\n    <label class="col-md-2 control-label">Welcome Link</label>\n    <div class="col-md-8">\n      <div class="input-group">\n        <input type="text" class="form-control" id="responder-link-root" value="'+(null==(__t=bridgelyApp.session.get("company").settings.responder_link_root)?"":__t)+'">\n        <span class="input-group-addon">/hash</span>\n      </div>\n      <small>Enter the root of the welcome link URL, a unique hash will be appended automatically for each employee</small>\n    </div>\n    <div class="col-md-2"></div>\n  </div>\n\n',bridgelyApp.session.get("admin")&&(__p+='\n  <div class="form-group clearfix">\n    <label class="col-md-2 control-label">Identifier</label>\n    <div class="col-md-8">\n      <input class="form-control" type="text" id="short-name" value="'+(null==(__t=bridgelyApp.session.get("company").short_name)?"":__t)+'"></input>\n    </div>\n    <div class="col-md-2"></div>\n  </div>\n'),__p+='\n\n  <div class="form-group clearfix">\n      <div class="col-md-2"></div>\n      <div class="col-md-8">\n        <button type="submit" class="btn btn-lg btn-danger btn-block"><span class="glyphicon glyphicon-flash"></span> Update Company</button>\n      </div>\n      <div class="col-md-2"><span class="help-block"><br />or, <a href="#">cancel</a></span></div>\n  </div>\n\n\n</div>\n\n<div class=\'col-md-2\'></div>\n';return __p},bridgelyApp.Routers=bridgelyApp.Routers||{},function(){"use strict";bridgelyApp.Routers.IndexRouter=Backbone.Router.extend({requireLogin:function(a){bridgelyApp.session.authenticated()?_.isFunction(a)&&a.call(this):bridgelyApp.LoginRouter.navigate("login",{trigger:!0})},routes:{"":"index",settings:"settings"},index:function(){bridgelyApp.session&&bridgelyApp.session.authenticated()?bridgelyApp.session.get("admin")?bridgelyApp.appView.trigger("admin-authenticated"):bridgelyApp.appView.trigger("authenticated"):bridgelyApp.appView.render()},settings:function(){this.requireLogin(function(){(new bridgelyApp.Views.SettingsView).render()})}})}(),bridgelyApp.Routers=bridgelyApp.Routers||{},function(){"use strict";bridgelyApp.Routers.LoginRouter=Backbone.Router.extend({routes:{login:"login"},login:function(){$("#content").html((new bridgelyApp.Views.LoginView).el)}})}(),bridgelyApp.Routers=bridgelyApp.Routers||{},function(){"use strict";bridgelyApp.Routers.AdminRouter=Backbone.Router.extend({routes:{"admin/users":"users","admin/companies":"companies","admin/companies/new":"newCompany"},requireLogin:function(a){bridgelyApp.session.authenticated()?_.isFunction(a)&&a.call(this):bridgelyApp.LoginRouter.navigate("login",{trigger:!0})},users:function(){console.log("admin users route!")},companies:function(){console.log("admin companies route!!"),this.requireLogin(function(){(new bridgelyApp.Views.AdminCompaniesView).render()})},newCompany:function(){console.log("admin new company route!!"),this.requireLogin(function(){(new bridgelyApp.Views.AdminNewCompanyView).render()})}})}(),bridgelyApp.Routers=bridgelyApp.Routers||{},function(){"use strict";bridgelyApp.Routers.DirectoryRouter=Backbone.Router.extend({requireLogin:function(a){bridgelyApp.session.authenticated()?_.isFunction(a)&&a.call(this):bridgelyApp.LoginRouter.navigate("login",{trigger:!0})},routes:{directory:"directory","directory/:page":"directory"},directory:function(a){this.requireLogin(function(){void 0!==a&&Number(a)||(a=0),(new bridgelyApp.Views.EmployeesView).render()})}})}(),bridgelyApp.Routers=bridgelyApp.Routers||{},function(){"use strict";bridgelyApp.Routers.EmployeeRouter=Backbone.Router.extend({requireLogin:function(a){bridgelyApp.session.authenticated()?_.isFunction(a)&&a.call(this):bridgelyApp.LoginRouter.navigate("login",{trigger:!0})},routes:{"employee/:id":"employee"},employee:function(a){this.requireLogin(function(){if(void 0===a||!Number(a))throw new Error("employee id must be present");var b=new bridgelyApp.Models.EmployeeModel({id:a});new bridgelyApp.Views.EmployeeView({model:b})})}})}(),bridgelyApp.Routers=bridgelyApp.Routers||{},function(){"use strict";bridgelyApp.Routers.MessageRouter=Backbone.Router.extend({requireLogin:function(a){bridgelyApp.session.authenticated()?_.isFunction(a)&&a.call(this):bridgelyApp.LoginRouter.navigate("login",{trigger:!0})},routes:{message:"newMessage","message/:id":"viewMessage","message-history":"messageHistory"},newMessage:function(){this.requireLogin(function(){(new bridgelyApp.Views.newMessageView).render()})},viewMessage:function(a){if(void 0===a||!Number(a))throw new Error("Route must be called with a valid id");console.log("View message id: "+a)},messageHistory:function(){this.requireLogin(function(){(new bridgelyApp.Views.MessagesView).render()})}})}(),bridgelyApp.Routers=bridgelyApp.Routers||{},function(){"use strict";bridgelyApp.Routers.QuestionRouter=Backbone.Router.extend({requireLogin:function(a){bridgelyApp.session.authenticated()?_.isFunction(a)&&a.call(this):bridgelyApp.LoginRouter.navigate("login",{trigger:!0})},routes:{question:"newQuestion","question/:id":"viewQuestion","question-history":"questionHistory"},newQuestion:function(){this.requireLogin(function(){(new bridgelyApp.Views.newQuestionView).render()})},viewQuestion:function(a){this.requireLogin(function(){if(void 0===a||!Number(a))throw new Error("Route must be called with a valid id");var b=new bridgelyApp.Models.QuestionModel({id:a});new bridgelyApp.Views.QuestionView({model:b})})},questionHistory:function(){console.log("view question history route")}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.AppView=Backbone.View.extend({initialize:function(){$.ajaxPrefilter(function(a){bridgelyApp.session.authenticated()&&(a.headers={Authorization:"Token token="+bridgelyApp.session.get("auth_token")})}),this.navbar=new bridgelyApp.Views.NavbarView,this.footer=new bridgelyApp.Views.FooterView,this.on("authenticated",this.authenticated,this),this.on("admin-authenticated",this.adminAuth,this),this.on("unauthenticate",this.unauthenticate,this),this.render()},template:JST["app/scripts/templates/app.ejs"],el:$("<main />"),render:function(){this.$el.html(this.template).attr("id","bridgely"),$("body").html(this.el),this.$el.prepend(this.navbar.$el),_.once(this.navbar.render()),this.$el.append(this.footer.$el)},unauthenticate:function(){this.render(),bridgelyApp.IndexRouter.navigate("",{trigger:!0})},authenticated:function(){bridgelyApp.DirectoryRouter.navigate("directory",{trigger:!0})},adminAuth:function(){bridgelyApp.AdminRouter.navigate("admin/companies",{trigger:!0})}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.NavbarView=Backbone.View.extend({template:JST["app/scripts/templates/navbar.ejs"],el:$('<nav role="navigation" />'),events:{"click .account":"settings","click .directory":"directory","click .login":"signIn","click .logout":"signOut","click .new-message":"newMessage","click .new-question":"newQuestion","click .message-history":"messageHistory","click .admin-users":"adminUsers","click .admin-companies":"adminCompanies"},settings:function(){event.preventDefault(),this.toggleSelected(),bridgelyApp.IndexRouter.navigate("settings",{trigger:!0})},directory:function(){event.preventDefault(),this.toggleSelected(),bridgelyApp.DirectoryRouter.navigate("directory",{trigger:!0})},newMessage:function(){event.preventDefault(),this.toggleSelected(),bridgelyApp.MessageRouter.navigate("message",{trigger:!0})},newQuestion:function(){event.preventDefault(),this.toggleSelected(),bridgelyApp.QuestionRouter.navigate("question",{trigger:!0})},messageHistory:function(){event.preventDefault(),this.toggleSelected(),bridgelyApp.MessageRouter.navigate("message-history",{trigger:!0})},adminUsers:function(){event.preventDefault(),this.toggleSelected(),bridgelyApp.AdminRouter.navigate("admin/users",{trigger:!0})},adminCompanies:function(){event.preventDefault(),this.toggleSelected(),bridgelyApp.AdminRouter.navigate("admin/companies",{trigger:!0})},signIn:function(){event.preventDefault(),this.toggleSelected(),bridgelyApp.LoginRouter.navigate("login",{trigger:!0})
},signOut:function(){event.preventDefault(),this.toggleSelected(),bridgelyApp.session.logout()},toggleSelected:function(){this.$(".active").removeClass("active"),$(event.target.parentElement).addClass("active")},render:function(){return this.$el.addClass("navbar navbar-default container"),this.$el.html(this.template()),this.delegateEvents(),this.el},initialize:function(){this.render(),bridgelyApp.session.on("change",function(){this.render()},this)}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.FooterView=Backbone.View.extend({template:JST["app/scripts/templates/footer.ejs"],el:$("<footer/>"),render:function(){this.$el.html(this.template),this.delegateEvents()},initialize:function(){this.render()}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.LoginView=Backbone.View.extend({template:JST["app/scripts/templates/login.ejs"],className:"form-login",render:function(){this.$el.html(this.template),this.$(".alert").hide()},events:{submit:"login"},login:function(a){a.preventDefault(),bridgelyApp.session.login(this.$("#email").val(),this.$("#password").val())},initialize:function(){this.render(),bridgelyApp.session.on("authentication-error",function(){this.$(".alert").fadeIn()},this)}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.EmployeesView=Backbone.View.extend({initialize:function(){this.collection=new bridgelyApp.Collections.EmployeesCollection,this.grid=new Backgrid.Grid({className:"table table-hover table-condensed backgrid",columns:this.columns,collection:this.collection}),bridgelyApp.session.get("admin")&&!bridgelyApp.session.get("company")&&this.grid.insertColumn([{name:"company_id",label:"Company ID",cell:"string",sortable:!0,editable:!1}]),this.listenTo(this.collection,"change add sync",this.render),this.listenTo(this.grid,"change",this.render),this.collection.fetch(),bridgelyApp.session.resetNewMessageEmployeeIds()},tags:function(){var a=this.collection.fullCollection.pluck("data"),b=[];return _.each(a,function(a){a.tags&&_.each(_.keys(a.tags),function(a){b.push(a)})}),_.uniq(b)},columns:[{name:"selected",label:"",cell:Backgrid.BooleanCell.extend({render:function(){return this.$el.empty(),this.$el.html(this.formatter.fromRaw(this.model.attributes)),this.delegateEvents(),this}}),formatter:_.extend({},Backgrid.CellFormatter.prototype,{fromRaw:function(a){var b=!1;return"all"!==bridgelyApp.session.get("new_message_employee_ids")&&(b=bridgelyApp.session.get("new_message_employee_ids").indexOf(a.id)>-1),$("<input type=checkbox />").attr("id",a.id).prop("checked",b)}}),sortable:!1,editable:!1},{name:"name",label:"Name",cell:Backgrid.StringCell.extend({render:function(){return this.$el.empty(),this.$el.html(this.formatter.fromRaw(this.model.attributes)),this.delegateEvents(),this}}),formatter:_.extend({},Backgrid.CellFormatter.prototype,{fromRaw:function(a){return $("<a />").attr("href","#").addClass(" employee employee-"+a.id).text(a.name)}}),editable:!1},{name:"phone",label:"Phone",cell:"string",editable:!1}],template:JST["app/scripts/templates/employees.ejs"],events:{"click .employee":"viewEmployee","click .boolean-cell input:checkbox":"check","click .tag-list-item input:checkbox":"toggleTag","click #sms-selected":"smsSelected","click #question-selected":"questionSelected","click #sms-all":"smsAll","click #question-all":"questionAll"},viewEmployee:function(){event.preventDefault();var a=event.target.className.split("-")[1];bridgelyApp.EmployeeRouter.navigate("employee/"+a,{trigger:!0})},check:function(a){this.$(".send-selected").prop("disabled",!1),a.target.checked?bridgelyApp.session.addNewMessageEmployeeId(parseInt(a.target.id)):(bridgelyApp.session.removeNewMessageEmployeeId(parseInt(a.target.id)),"all"===bridgelyApp.session.get("new_message_employee_ids")&&this.$(".send-selected").prop("disabled",!0))},toggleTag:function(a){if(a.target.checked)this.grid.insertColumn([{name:"data",label:a.target.name,cell:"string",formatter:_.extend({},Backgrid.CellFormatter.prototype,{fromRaw:function(b){return b.tags=b.tags||{},b.tags[a.target.name]}}),sortable:!0,editable:!1}]);else{var b=this.grid.columns.where({label:a.target.name});this.grid.removeColumn(b)}},smsSelected:function(a){a.preventDefault(),bridgelyApp.MessageRouter.navigate("message",{trigger:!0})},questionSelected:function(a){a.preventDefault(),bridgelyApp.QuestionRouter.navigate("question",{trigger:!0})},smsAll:function(a){a.preventDefault(),bridgelyApp.session.set("new_message_employee_ids","all"),bridgelyApp.MessageRouter.navigate("message",{trigger:!0})},questionAll:function(a){a.preventDefault(),bridgelyApp.session.set("new_message_employee_ids","all"),bridgelyApp.QuestionRouter.navigate("question",{trigger:!0})},render:function(){var a=new Backgrid.Extension.Paginator({collection:this.collection}),b=Backgrid.Extension.ClientSideFilter.extend({template:_.template('<input type="search" results=0 autocomplete="off" <% if (placeholder) { %> placeholder="<%- placeholder %>" <% } %> name="<%- name %>" /><a class="clear" href="#">&times;</a>'),makeMatcher:function(a){var b=this.makeRegExp(a);return function(a){for(var c=this.fields||a.keys(),d=0,e=c.length;e>d;d++)if("data"===c[d]&&a.get(c[d]).tags){var f=a.get(c[d]);for(var g in f.tags)if(b.test(f.tags[g]+""))return!0}else if(b.test(a.get(c[d])+""))return!0;return!1}}}),c=new b({className:"form-search",placeholder:"Filter Directory",collection:this.collection.fullCollection});return $("#content").html(this.$el.html(this.template(this.collection))),$(".backgrid-container").prepend(this.grid.render().$el).append(a.render().$el),$(".grid-filter").html(c.render().$el),this.delegateEvents(),this.el}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.EmployeeView=Backbone.View.extend({model:bridgelyApp.Models.EmployeeModel,template:JST["app/scripts/templates/employee.ejs"],events:{"click .back":"back","click .question":"viewQuestion"},back:function(){event.preventDefault(),bridgelyApp.DirectoryRouter.navigate("directory",{trigger:!0})},viewQuestion:function(){event.preventDefault();var a=$(event.target).parent()[0].className.split("-")[1];bridgelyApp.QuestionRouter.navigate("question/"+a,{trigger:!0})},render:function(){return $("#content").html(this.$el),this.$el.html(this.template()).addClass("list-group"),this.model.get("data")&&this.model.get("data").tags&&$(".tags").append(_(this.model.get("data").tags).map(function(a,b){var c=$("<span />").text(" "+a+" "),d=$("<span />").addClass("label label-default").text(b+":");return c.prepend(d),c})),this.model.get("messages")&&_(this.model.get("messages").reverse()).each(function(a){var b=$("<div />").addClass("list-group-item");if(b.append($("<h4 />").addClass("list-group-item-heading").text(a.message.body)),b.append($("<p />").addClass("list-group-item-text").text(a.message.direction)),a.question_id){var c=$("<span />").addClass("pull-right");"outbound"===a.message.direction?c.text("Asked: "):c.text("Answered: ");var d=$("<a />").prop("href","#").addClass("question question-"+a.question.id);d.append($("<span />").addClass("label label-default").text(a.question.title)),c.append(d),b.find(".list-group-item-text").prepend(c)}this.$(".messages").append(b)},this),this.$(".preloader").hide(),this.delegateEvents(),this.el},getMessages:function(){var a=this;$.ajax({method:"GET",url:bridgelyApp.apiUrl+"/employees/"+this.model.id+"/messages",success:function(b){a.model.set("messages",b)}})},initialize:function(){this.model.fetch(),this.getMessages(),this.render(),this.model.on("sync change",this.render,this)}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.newMessageView=Backbone.View.extend({template:JST["app/scripts/templates/newMessage.ejs"],el:$("<form />"),render:function(){return this.$el.html(this.template),$("#content").html(this.el),this.$("textarea").limiter(160,$("#chars")),bridgelyApp.session.get("company")||this.$("button[type=submit]").prop("disabled",!0).text("Select a company first..."),this.delegateEvents(),this.el},events:{submit:"sendMessage","click #success-button":"next","click .canel":"cancel"},sendMessage:function(a){a.preventDefault(),this.$("button[type=submit]").prop("disabled",!0);var b=bridgelyApp.session.get("new_message_employee_ids");"all"!==b&&(b=b.join()),$.ajax({type:"POST",url:bridgelyApp.apiUrl+"/messages",data:{message:{body:this.$("textarea").val(),employee_ids:b,company_id:bridgelyApp.session.get("company").id}},success:function(){console.log("message sent successfully"),bridgelyApp.session.resetNewMessageEmployeeIds(),$("#successModal").modal({backdrop:"static",keyboard:!1})},error:function(){console.log("mesaage send failed!!"),bridgelyApp.session.resetNewMessageEmployeeIds()}})},next:function(){this.$("#successModal").on("hidden.bs.modal",function(){bridgelyApp.MessageRouter.navigate("message-history",{trigger:!0})}),this.$("#successModal").modal("hide")},cancel:function(){event.preventDefault(),bridgelyApp.DirectoryRouter.navigate("directory",{trigger:!0})}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.newQuestionView=Backbone.View.extend({template:JST["app/scripts/templates/newQuestion.ejs"],el:$("<form />"),render:function(){return this.delegateEvents(),this.$el.html(this.template),$("#content").html(this.el),this.$("textarea").limiter(160,$("#chars")),bridgelyApp.session.get("company")||this.$("button[type=submit]").prop("disabled",!0).text("Select a company first..."),this.el},events:{submit:"sendQuestion","click #success-button":"next","click .cancel":"cancel"},sendQuestion:function(a){a.preventDefault(),this.$("button[type=submit]").prop("disabled",!0);var b=bridgelyApp.session.get("new_message_employee_ids");"all"!==b&&(b=b.join()),$.ajax({type:"POST",url:bridgelyApp.apiUrl+"/questions",data:{question:{title:this.$("#question-title").val(),response_tag:this.$("#question-title").val(),message:{body:this.$("textarea").val(),employee_ids:b,company_id:bridgelyApp.session.get("company").id}}},success:function(){console.log("question sent successfully"),bridgelyApp.session.resetNewMessageEmployeeIds(),$("#successModal").modal({backdrop:"static",keyboard:!1})},error:function(){console.log("question send failed!!"),bridgelyApp.session.resetNewMessageEmployeeIds()}})},next:function(){this.$("#successModal").on("hidden.bs.modal",function(){bridgelyApp.MessageRouter.navigate("message-history",{trigger:!0})}),this.$("#successModal").modal("hide")},cancel:function(){event.preventDefault(),bridgelyApp.DirectoryRouter.navigate("directory",{trigger:!0})}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.MessagesView=Backbone.View.extend({initialize:function(){this.collection=new bridgelyApp.Collections.MessagesCollection,this.listenTo(this.collection,"change add",this.render),this.collection.fetch()},columns:[{name:"employee_ids",label:"Quantity",cell:Backgrid.StringCell.extend({render:function(){return this.$el.empty(),this.$el.html(this.formatter.fromRaw(this.model.get("employee_ids"),this.model.get("direction"))),this.delegateEvents(),this}}),formatter:_.extend({},Backgrid.CellFormatter.prototype,{fromRaw:function(a,b){var c="inbound"===b?"Received":"Sent";return 0===a.length?$("<code />").text("0 "+c):a.length+" "+c}}),editable:!1},{name:"question",label:"Question",cell:Backgrid.StringCell.extend({render:function(){return this.$el.empty(),this.model.attributes.question&&this.$el.html(this.formatter.fromRaw(this.model.attributes.question)),this.delegateEvents(),this}}),formatter:_.extend({},Backgrid.CellFormatter.prototype,{fromRaw:function(a){return $("<a />").attr("href","#").addClass("question question-"+a.id).text(a.title)}}),editable:!1},{name:"body",label:"Message",cell:"string",editable:!1}],messagesGrid:function(){return new Backgrid.Grid({className:"table table-hover table-condensed backgrid",columns:this.columns,collection:this.collection})},template:JST["app/scripts/templates/messages.ejs"],events:{"click .question":"viewQuestion"},viewQuestion:function(){event.preventDefault();var a=event.target.className.split("-")[1];bridgelyApp.QuestionRouter.navigate("question/"+a,{trigger:!0})},render:function(){var a=new Backgrid.Extension.Paginator({collection:this.collection});return $("#content").html(this.$el.html(this.template)),$(".backgrid-container").prepend(this.messagesGrid().render().$el).append(a.render().$el),this.delegateEvents(),this.el}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.MessageView=Backbone.View.extend({template:JST["app/scripts/templates/message.ejs"],render:function(){return this.$el.html(this.template(this.model.attributes)),this.el}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.QuestionView=Backbone.View.extend({model:bridgelyApp.Models.QuestionView,template:JST["app/scripts/templates/question.ejs"],events:{"click .back":"back","click .employee":"viewEmployee"},back:function(){event.preventDefault(),bridgelyApp.MessageRouter.navigate("message-history",{trigger:!0})},viewEmployee:function(){event.preventDefault;var a=event.target.className.split("-")[1];bridgelyApp.EmployeeRouter.navigate("employee/"+a,{trigger:!0})},getEmployees:function(){var a=this;$.ajax({method:"GET",url:this.model.url()+"/employees",success:function(b){a.model.set("employees",b)}})},render:function(){return $("#content").html(this.$el),this.$el.html(this.template()),this.delegateEvents(),this.el},initialize:function(){$("html, body").scrollTop(0),this.model.fetch(),this.getEmployees(),this.model.on("sync change",this.render,this)}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.SettingsView=Backbone.View.extend({template:JST["app/scripts/templates/settings.ejs"],el:$("<form />"),events:{submit:"submitSettings","click .cancel":"cancel"},render:function(){return this.delegateEvents(),this.$el.html(this.template),$("#content").html(this.el),bridgelyApp.session.get("company")?this.$("textarea").val(bridgelyApp.session.get("company").settings.autoresponder).limiter(160,$("#chars")):this.$("button[type=submit]").prop("disabled",!0).text("Select a company first..."),this.el},cancel:function(){event.preventDefault(),bridgelyApp.IndexRouter.navigate("",{trigger:!0})},submitSettings:function(a){a.preventDefault(),this.$("button[type=submit]").prop("disabled",!0);var b={company:{settings:{autoresponder:this.$("textarea").val(),responder_link_root:this.$("#responder-link-root").val()}}};bridgelyApp.session.get("admin")&&(b.company.short_name=this.$("#short-name").val()),$.ajax({type:"PUT",url:bridgelyApp.apiUrl+"/admin/companies/"+bridgelyApp.session.get("company").id,data:b,success:function(a){bridgelyApp.session.set("company",a),bridgelyApp.MessageRouter.navigate("directory",{trigger:!0})},error:function(){}})}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.AdminCompaniesView=Backbone.View.extend({template:JST["app/scripts/templates/adminCompanies.ejs"],initialize:function(){this.collection=new bridgelyApp.Collections.AdminCompaniesCollection,this.collection.on("sync",function(){this.render()},this),this.collection.fetch(),this.unloadCompany()},events:{"click .company":"loadCompany","click .btn-company":"newCompany"},render:function(){return this.$el.html(this.template(this.collection.models)),$("#content").html(this.el),this.delegateEvents(),this.el},loadCompany:function(a){a.preventDefault();var b=$(a.target).closest(".company")[0].id,c=b.slice(b.indexOf("-")+1);$.ajax({method:"GET",url:bridgelyApp.apiUrl+"/admin/companies/"+c,success:function(a){bridgelyApp.session.set("company",a),bridgelyApp.DirectoryRouter.navigate("directory",{trigger:!0}),new bridgelyApp.Views.AdminCompanyTopbar}})},unloadCompany:function(){$("#topbar").empty(),bridgelyApp.session.set("company",null)},newCompany:function(a){a.preventDefault(),bridgelyApp.AdminRouter.navigate("admin/companies/new",{trigger:!0})}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.AdminNewCompanyView=Backbone.View.extend({template:JST["app/scripts/templates/adminNewCompany.ejs"],el:$("<form />"),events:{submit:"createCompany","click .cancel":"cancel"},createCompany:function(a){a.preventDefault(),this.$("button[type=submit]").prop("disabled",!0),$.ajax({type:"POST",url:bridgelyApp.apiUrl+"/admin/companies",data:{company:{name:this.$("input[name=company-name]").val(),short_name:this.$("input[name=company-short-name]").val(),settings:{autoresponder:this.$("textarea[name=autoresponder]").val(),responder_link_root:this.$("input[name=autoresponder-link]").val()},users:{email:this.$("input[name=email]").val(),name:this.$("input[name=users-name]").val(),password:this.$("input[name=password]").val()}}},success:function(){console.log("company created successfully"),bridgelyApp.AdminRouter.navigate("admin/companies",{trigger:!0})},error:function(){console.log("mesaage send failed!!"),bridgelyApp.AdminRouter.navigate("admin/companies",{trigger:!0}),alert("Oh no, something went wrong. Try again...")}})},cancel:function(){event.preventDefault(),bridgelyApp.AdminRouter.navigate("admin/companies",{trigger:!0})},render:function(){return this.$el.html(this.template).addClass("form-horizontal").attr("role","form"),$("#content").html(this.el),this.delegateEvents(),this.el}})}(),bridgelyApp.Views=bridgelyApp.Views||{},function(){"use strict";bridgelyApp.Views.AdminCompanyTopbar=Backbone.View.extend({template:JST["app/scripts/templates/adminCompanyTopbar.ejs"],events:{"click .admin-return":"clearAdminCompany"},clearAdminCompany:function(){$("#topbar").empty(),bridgelyApp.session.set("company",null),bridgelyApp.AdminRouter.navigate("admin/companies",{trigger:!0})},render:function(){return $("#topbar").empty(),this.$el.html(this.template).addClass("panel panel-danger admin-topbar"),this.delegateEvents(),this.el},initialize:function(){$("#topbar").append(this.render())}})}(),bridgelyApp.Models=bridgelyApp.Models||{},function(){"use strict";bridgelyApp.Models.MessageModel=Backbone.Model.extend({defaults:{id:null,body:null,direction:null,company_id:null,question_id:null,employee_ids:[]}})}(),bridgelyApp.Models=bridgelyApp.Models||{},function(){"use strict";bridgelyApp.Models.QuestionModel=Backbone.Model.extend({defaults:{id:null,title:null,message:null,employees:null},url:function(){return bridgelyApp.apiUrl+"/questions/"+this.id}})}(),bridgelyApp.Models=bridgelyApp.Models||{},function(){"use strict";bridgelyApp.Models.SessionModel=Backbone.Model.extend({defaults:{name:null,short_name:null,email:null,admin:!1,company:null,auth_token:null,new_message_employee_ids:"all"},url:function(){return bridgelyApp.apiUrl+"/auth"},initialize:function(){this.storage=localStorage,this.load()},authenticated:function(){return!!this.get("auth_token")},login:function(a,b){var c=this;$.ajax({type:"POST",url:this.url()+"/login",data:{session:{email:a,password:b}},success:function(a){a.admin===!0&&(this.admin=!0),c.save(a),c.load(),this.admin?bridgelyApp.appView.trigger("admin-authenticated"):bridgelyApp.appView.trigger("authenticated")},error:function(){c.trigger("authentication-error")}})},logout:function(){if(this.authenticated()){var a=this;$.ajax({type:"DELETE",url:this.url()+"/logout",complete:function(){a.destroy(),bridgelyApp.appView.trigger("unauthenticate")}})}},save:function(a){this.storage.setItem("session",JSON.stringify(a))},load:function(){if(this.storage.length>0&&this.storage.getItem("session")){var a=JSON.parse(this.storage.getItem("session"));this.set({name:a.name,short_name:a.short_name,email:a.email,admin:a.admin,company:a.company,auth_token:a.authorization_token})}},destroy:function(){this.storage.clear(),this.set({name:null,short_name:null,email:null,admin:!1,company:null,auth_token:null,new_message_employee_ids:"all"})},addNewMessageEmployeeId:function(a){var b=this.get("new_message_employee_ids");"all"===b&&(b=[]),b.push(a),this.set("new_message_employee_ids",b)},removeNewMessageEmployeeId:function(a){var b=this.get("new_message_employee_ids");if("all"===b||b===[]||-1===b.indexOf(a))throw new Error("Cannot remove employee id");var c=_(b).without(a);0===c.length&&(c="all"),this.set("new_message_employee_ids",c)},resetNewMessageEmployeeIds:function(){this.set("new_message_employee_ids","all")}})}(),bridgelyApp.Models=bridgelyApp.Models||{},function(){"use strict";bridgelyApp.Models.EmployeeModel=Backbone.Model.extend({defaults:{name:null,phone:null,company_id:null,data:null},url:function(){return bridgelyApp.apiUrl+"/employees/"+this.id}})}(),bridgelyApp.Models=bridgelyApp.Models||{},function(){"use strict";bridgelyApp.Models.AdminCompanyModel=Backbone.Model.extend({defaults:{name:null,settings:null,users:null}})}(),bridgelyApp.Collections=bridgelyApp.Collections||{},function(){"use strict";bridgelyApp.Collections.EmployeesCollection=Backbone.PageableCollection.extend({model:bridgelyApp.Models.EmployeeModel,url:function(){return bridgelyApp.session.get("admin")&&!bridgelyApp.session.get("company")?bridgelyApp.apiUrl+"/employees":bridgelyApp.apiUrl+"/companies/"+bridgelyApp.session.get("company").id+"/employees"},state:{pageSize:50},mode:"client"})}(),bridgelyApp.Collections=bridgelyApp.Collections||{},function(){"use strict";bridgelyApp.Collections.MessagesCollection=Backbone.PageableCollection.extend({model:bridgelyApp.Models.MessageModel,url:function(){return bridgelyApp.session.get("admin")&&!bridgelyApp.session.get("company")?bridgelyApp.apiUrl+"/messages":bridgelyApp.apiUrl+"/companies/"+bridgelyApp.session.get("company").id+"/messages"},state:{pageSize:50},mode:"client"})}(),bridgelyApp.Collections=bridgelyApp.Collections||{},function(){"use strict";bridgelyApp.Collections.AdminCompaniesCollection=Backbone.Collection.extend({model:bridgelyApp.Models.AdminCompanyModel,url:function(){return bridgelyApp.apiUrl+"/admin/companies"}})}();